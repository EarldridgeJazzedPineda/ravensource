DEF[PORTVERSION]=	0.4.3
# ----------------------------------------------------------------------------

NAMEBASE=		anet
VERSION=		${PORTVERSION}
KEYWORDS=		net
VARIANTS=		standard
SDESC[standard]=	Networking library for Ada
HOMEPAGE=		https://www.codelabs.ch/anet/
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		https://www.codelabs.ch/download/
DISTFILE[1]=		libanet-${PORTVERSION}.tar.bz2:main

SPKGS[standard]=	complete primary docs

OPTIONS_AVAILABLE=	TESTED
OPTIONS_STANDARD=	TESTED

LICENSE=		GMGPL:primary
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_FILE=		GMGPL:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"^pragma"
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/src/anet.ads
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		net/anet

BUILD_DEPENDS=		ruby-asciidoctor:single:ruby_default
			source-highlight:primary:standard

USES=			gprbuild gmake ada:primary
BUILD_TARGET=		all build-doc
DISTNAME=		libanet-${PORTVERSION}
MAKE_ARGS=		NUM_CPUS={{MAKE_JOBS_NUMBER}}
INSTALL_REQ_TOOLCHAIN=	yes

VAR_OPSYS[dragonfly]=	MAKE_ARGS=OS=bsd
VAR_OPSYS[freebsd]=	MAKE_ARGS=OS=bsd
VAR_OPSYS[netbsd]=	MAKE_ARGS=OS=bsd

[TESTED].DESCRIPTION=			Run unit test suite before installation
[TESTED].BUILD_DEPENDS_ON=		ahven:primary:standard
[TESTED].BUILD_TARGET_ON=		build-tests

pre-configure:
	${REINPLACE_CMD} -e 's|=lib/gnat|=share/gpr|' ${WRKSRC}/Makefile
	${REINPLACE_CMD} -e 's|"dynamic"|"static-pic"|' ${WRKSRC}/anet.gpr

post-install:
	(cd ${WRKSRC}/doc && ${COPYTREE_SHARE} html ${STAGEDIR}${STD_DOCDIR})

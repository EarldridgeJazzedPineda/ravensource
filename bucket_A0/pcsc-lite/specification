DEF[PORTVERSION]=	2.0.3
# ----------------------------------------------------------------------------

NAMEBASE=		pcsc-lite
VERSION=		${PORTVERSION}
KEYWORDS=		devel security
VARIANTS=		standard
SDESC[standard]=	Smartcard development library
HOMEPAGE=		https://pcsclite.apdu.fr/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://pcsclite.apdu.fr/files/
DISTFILE[1]=		pcsc-lite-${PORTVERSION}.tar.bz2:main

SPKGS[standard]=	complete primary tools dev man docs

OPTIONS_AVAILABLE=	FILTER
OPTIONS_STANDARD=	FILTER

LICENSE=		BSD3CLAUSE:primary
LICENSE_FILE=		BSD3CLAUSE:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		devel/pcsc-lite

EXRUN[tools]=		primary

B_DEPS[linux]=		libusb:dev:standard
B_DEPS[sunos]=		libusb:dev:standard

BR_DEPS[linux]=		libusb:primary:standard
BR_DEPS[sunos]=		libusb:primary:standard

BUILDRUN_DEPENDS=	polkit:primary:standard

USES=			cpe libtool perl:build pkgconfig python shebangfix
GNOME_COMPONENTS=	glib
CPE_VENDOR=		muscle
MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--enable-usbdropdir={{PREFIX}}/lib/pcsc/drivers/
			--disable-libsystemd
INSTALL_TARGET=		install-strip
RC_SUBR=		pcscd:primary
SUB_FILES=		pkg-message-primary
SHEBANG_FILES=		src/spy/pcsc-spy

VAR_OPSYS[netbsd]=	CONFIGURE_ARGS=--disable-usb

[FILTER].DESCRIPTION=			Control reader names reported by PCSC
[FILTER].CONFIGURE_ENABLE_BOTH=		filter

post-patch:
	${REINPLACE_CMD} -e "s,^datadir,#datadir,; s,^data_DATA,#data_DATA," \
		${WRKSRC}/doc/Makefile.in
	${REINPLACE_CMD} -e "s,libusb-1.0/libusb.h,libusb.h,; \
		s,libusb_strerror(ret),ret," ${WRKSRC}/configure \
			${WRKSRC}/src/hotplug_libusb.c

post-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/lib/pcsc/drivers
	${MKDIR} ${STAGEDIR}${PREFIX}/lib/pcsc/services

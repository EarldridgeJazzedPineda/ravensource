DEF[PORTVERSION]=	0.57
DEF[GPR]=		{{LOCALBASE}}/lib/gnat
# ----------------------------------------------------------------------------

NAMEBASE=		ravenadm
VERSION=		${PORTVERSION}
REVISION=		2
KEYWORDS=		raven
VARIANTS=		standard
SDESC[standard]=	Ravenports administration utility
HOMEPAGE=		https://github.com/jrmarino/ravenadm
CONTACT=		John_Marino[draco@marino.st]

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/jrmarino:ravenadm:88ff437
DISTFILE[1]=		generated:main

SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		ISCL:single
LICENSE_FILE=		ISCL:{{WRKSRC}}/License.txt
LICENSE_SCHEME=		solo

BUILD_DEPENDS=		adacurses:primary:standard

USES=			gprbuild ncurses

# We have to link ncurses dynamically to force the terminfo database
# to be installed as well.  Otherwises a term error will probably occur.

post-extract:
	@${REINPLACE_CMD} -e "s|/raven|${LOCALBASE}|" \
		-e "s|:= dragonfly|:= ${OPSYS:tl}|" \
		${WRKSRC}/src/definitions.ads
	# ensure Tampering_Check is active
	@${REINPLACE_CMD} -e '/pragma Suppress/ s|--  ||' \
		${WRKSRC}/src/portscan.ads \
		${WRKSRC}/src/port_specification.ads

do-build:
	(cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} \
		gprbuild -p -P ravenadm)
	(cd ${WRKSRC}/ravenexec && ${SETENV} ${MAKE_ENV} \
		${CC} ravenexec.c -o ../build/ravenexec)

do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/share/ravenadm \
		${STAGEDIR}/var/ravenports/primary \
		${STAGEDIR}/var/ravenports/distfiles \
		${STAGEDIR}/var/ravenports/conspiracy
	${INSTALL_PROGRAM} ${WRKSRC}/build/ravenadm \
		${STAGEDIR}${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/build/ravenexec \
		${STAGEDIR}${PREFIX}/libexec
# ${INSTALL_MAN} ${WRKSRC}/ravenadm.1 ${STAGEDIR}${MANPREFIX}/man/man1
	${INSTALL_DATA} ${WRKSRC}/www/* ${STAGEDIR}${PREFIX}/share/ravenadm

DEF[PORTVERSION]=	2.7.3
DEF[GEMS_BASE_DIR]=	lib/ruby/gems
# ----------------------------------------------------------------------------

NAMEBASE=		ruby-rubygems
VERSION=		${PORTVERSION}
KEYWORDS=		ruby devel
VARIANTS=		v23 v24
SDESC[v23]=		Package management framework for Ruby (v2.3)
SDESC[v24]=		Package management framework for Ruby (v2.4)
HOMEPAGE=		https://rubygems.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		https://rubygems.org/rubygems/
DISTFILE[1]=		rubygems-${PORTVERSION}.tgz:main
DIST_SUBDIR=		ruby

SPKGS[v23]=		single
SPKGS[v24]=		single

OPTIONS_AVAILABLE=	RUBY23 RUBY24
OPTIONS_STANDARD=	none
VOPTS[v23]=		RUBY23=ON RUBY24=OFF
VOPTS[v24]=		RUBY23=OFF RUBY24=ON

FPC_EQUIVALENT=		devel/ruby-gems

LICENSE=		MIT:single RUBY:single
LICENSE_FILE=		MIT:{{WRKSRC}}/MIT.txt
			RUBY:{{WRKSRC}}/LICENSE.txt
LICENSE_SCHEME=		dual

SKIP_BUILD=		yes

DISTNAME=		rubygems-${PORTVERSION}
PLIST_SUB=		DISTNAME="{{DISTNAME}}"
			SUFFIX="{{RUBY_SUFFIX}}"
			GEMS_DIR="${GEMS_BASE_DIR}/{{RUBY_VER}}/gems"
			CACHE_DIR="${GEMS_BASE_DIR}/{{RUBY_VER}}/cache"
			SPEC_DIR="${GEMS_BASE_DIR}/{{RUBY_VER}}/specifications"
			EXT_DIR="${GEMS_BASE_DIR}/{{RUBY_VER}}/extensions"
			DOC_DIR="${GEMS_BASE_DIR}/{{RUBY_VER}}/doc"

[RUBY23].USES_ON=			ruby:v23
[RUBY23].MAKEFILE_ON=			GEMLINK2.3=""
					GEMLINK2.4="@comment "
[RUBY24].USES_ON=			ruby:v24
[RUBY24].MAKEFILE_ON=			GEMLINK2.3="@comment "
					GEMLINK2.4=""

do-install:
	cd ${WRKSRC} && ${SETENV} \
		GEM_HOME=${STAGEDIR}${PREFIX}/${GEMS_BASE_DIR}/${RUBY_VER} \
		${RUBY} ${RUBY_SETUP} --destdir=${STAGEDIR} --no-ri --no-rdoc

do-install-RUBY23-ON:
	if [ "${RUBY_DEFAULT}" = "2.3" ]; then \
	${LN} -sf gem${RUBY_SUFFIX} ${STAGEDIR}${PREFIX}/bin/gem; \
	fi

do-install-RUBY24-ON:
	if [ "${RUBY_DEFAULT}" = "2.4" ]; then \
	${LN} -sf gem${RUBY_SUFFIX} ${STAGEDIR}${PREFIX}/bin/gem; \
	fi

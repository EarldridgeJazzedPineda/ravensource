DEF[PORTVERSION]=	0.7.2
# ----------------------------------------------------------------------------

NAMEBASE=		deadbeef
VERSION=		${PORTVERSION}
KEYWORDS=		audio
VARIANTS=		standard
SDESC[standard]=	Ultimate music player for Unix-like systems
HOMEPAGE=		http://deadbeef.sourceforge.net/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		SF/deadbeef
DISTFILE[1]=		deadbeef-${PORTVERSION}.tar.bz2:main

SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

FPC_EQUIVALENT=		audio/deadbeef

RUN_DEPENDS=		freepats:single:standard
BUILD_DEPENDS=		yasm:single:standard
BUILDRUN_DEPENDS=	libmad:single:standard
			jansson:single:standard
			curl:primary:standard
			imlib2:single:standard
			libvorbis:primary:standard
			flac:primary:standard
			libsndfile:primary:standard
			wavpack:single:standard
			faad2:single:standard
			libsamplerate:primary:standard
			libzip:single:standard

USES=			desktop-utils gmake iconv libtool pkgconfig
			shebangfix gettext-tools jpeg gnome-icons
GNOME_COMPONENTS=	intltool gtk3
INSTALL_TARGET=		install-strip
MUST_CONFIGURE=		gnu
CONFIGURE_ARGS=		--disable-alsa
			--disable-nullout
			--disable-static
			--disable-cdda
			--disable-gtk2
			--enable-gtk3
CPPFLAGS=		-I../dumb/dumb-kode54/include
			-I../../plugins/libmp4ff
			-I../../plugins/gme/game-music-emu-0.6pre
			-I./sidplay-libs/libsidplay/include/sidplay
SHEBANG_FILES=		yasmwrapper.sh

post-patch:
	# Do not link to libsupc++ which may be PIC-unsafe (breaks 64-bit arches)
	${REINPLACE_CMD} -e 's, -lsupc++,,' \
		${WRKSRC}/plugins/adplug/Makefile.in \
		${WRKSRC}/plugins/gme/Makefile.in \
		${WRKSRC}/plugins/sid/Makefile.in \
		${WRKSRC}/plugins/supereq/Makefile.in
	${REINPLACE_CMD} -e 's,/etc/timidity++/timidity-freepats.cfg:/etc/timidity/freepats.cfg:/etc/timidity/,${LOCALBASE}/share/,' \
		${WRKSRC}/plugins/wildmidi/wildmidiplug.c
	${REINPLACE_CMD} \
		-e '/HAVE_OGG" = "yes"/ {n; n; /HAVE_VORBISPLUGIN=yes/d;}' \
		${WRKSRC}/configure

	# Fix build with libzip-1.0
	${REINPLACE_CMD} 's,zip_file_t,zip_file_DB,g' \
		${WRKSRC}/plugins/vfs_zip/vfs_zip.c

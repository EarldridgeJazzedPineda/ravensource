cmake_minimum_required(VERSION 3.16)
project(cbsd)

SET(CMAKE_SKIP_BUILD_RPATH TRUE)
add_subdirectory(misc)
add_subdirectory(bin)
add_subdirectory(sbin)
add_subdirectory(tools)

install(DIRECTORY bhyvectl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "b*")
install(DIRECTORY jailctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "j*")
install(DIRECTORY nodectl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "n*")
install(DIRECTORY qemuctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "q*")
install(DIRECTORY vboxctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "v*")
install(DIRECTORY xenctl DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "x*")
install(DIRECTORY .ssh DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY rc.d DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY subr DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY sudoexec DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY system DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY release DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY upgrade DESTINATION cbsd USE_SOURCE_PERMISSIONS)
install(DIRECTORY man DESTINATION cbsd USE_SOURCE_PERMISSIONS FILES_MATCHING PATTERN "*.[12345678]")
install(DIRECTORY etc/defaults DESTINATION cbsd/etc USE_SOURCE_PERMISSIONS)
install(DIRECTORY modules/
  DESTINATION cbsd/modules
  USE_SOURCE_PERMISSIONS
  PATTERN ".gitignore" EXCLUDE
  PATTERN "placeholder" EXCLUDE
)
install(DIRECTORY share/
  DESTINATION cbsd/share
  USE_SOURCE_PERMISSIONS
  PATTERN "placeholder" EXCLUDE
)
install(DIRECTORY tools/
  DESTINATION cbsd/tools
  USE_SOURCE_PERMISSIONS
  PATTERN "src" EXCLUDE
  PATTERN "CMakeLists.txt" EXCLUDE
)
install(DIRECTORY misc/
  DESTINATION cbsd/misc
  USE_SOURCE_PERMISSIONS
  PATTERN "src" EXCLUDE
  PATTERN "CMakeLists.txt" EXCLUDE
)

install(FILES man/cbsd.8 DESTINATION share/man/man8)
install(FILES securecmd ObsoleteFiles DESTINATION cbsd)
install(FILES cbsd.conf DESTINATION cbsd RENAME cbsd.conf.sample)
install(FILES etc/modules.conf DESTINATION cbsd/etc RENAME modules.conf.sample)
install(FILES etc/spice.conf DESTINATION cbsd/etc RENAME spice.conf.sample)

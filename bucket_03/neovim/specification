DEF[PORTVERSION]=	0.2.2
DEF[SPEC_LUA]=		5.2
DEF[LUA_VARIANT]=	lua${SPEC_LUA:S/.//}
# ----------------------------------------------------------------------------

NAMEBASE=		neovim
VERSION=		${PORTVERSION}
KEYWORDS=		editors
VARIANTS=		standard
SDESC[standard]=	Next generation Vim
HOMEPAGE=		http://neovim.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/neovim:neovim:v${PORTVERSION}
DISTFILE[1]=		generated:main

SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

FPC_EQUIVALENT=		editors/neovim

BUILDRUN_DEPENDS=	msgpack:single:standard
			libtermkey:single:standard
			libvterm:single:standard
			libuv:single:standard
BUILD_DEPENDS=		gperf:single:standard
			lua-lpeg:single:${LUA_VARIANT}
			lua-bitop:single:${LUA_VARIANT}
			lua-mpack:single:${LUA_VARIANT}

USES=			cmake:outsource gmake libtool pkgconfig lua:${SPEC_LUA}
			gettext-tools gettext-runtime
CMAKE_ARGS=		-DCMAKE_SKIP_BUILD_RPATH:BOOL=YES
			-DDEPS_PREFIX:PATH="{{LOCALBASE}}"
			-DLUA_PRG:FILEPATH="{{LOCALBASE}}/bin/{{LUA_CMD}}"
			-DPREFER_LUA:BOOL=YES
INSTALL_REQ_TOOLCHAIN=	yes

post-patch-sunos:
	${REINPLACE_CMD} -e 's|STR(|STR_(|g' \
		${WRKSRC}/src/nvim/eval/typval_encode.c.h \
		${WRKSRC}/src/nvim/version.c
	${REINPLACE_CMD} -e 's|util||' \
		${WRKSRC}/src/nvim/CMakeLists.txt

post-install:
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/nvim

DEF[PORTVERSION]=	4.19.1.1
DEF[SOVERSION]=		10.0.2
DEF[BINARIES]=		rpm rpm2archive rpm2cpio rpmbuild rpmdb rpmgraph rpmkeys rpmlua rpmsign rpmsort rpmspec
DEF[LIBRARIES]=		librpm librpmbuild librpmio librpmsign
DEF[PLUGINS]=		dbus_announce fapolicyd prioreset syslog systemd_inhibit
# ----------------------------------------------------------------------------

NAMEBASE=		rpm
VERSION=		${PORTVERSION}
KEYWORDS=		archivers
VARIANTS=		standard
SDESC[standard]=	RPM Package Manager
HOMEPAGE=		https://rpm.org/
CONTACT=		Michael_Reim[kraileth@elderlinux.org]

DOWNLOAD_GROUPS=	main
SITES[main]=		http://ftp.rpm.org/releases/rpm-${PORTVERSION:R:R}.x/
DISTFILE[1]=		rpm-${PORTVERSION}.tar.bz2:main

SPKGS[standard]=	complete primary library python dev man nls docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

# Library and rpmio are dual GPLv2 and LGPL20
LICENSE=		GPLv2:primary
LICENSE_FILE=		GPLv2:stock
LICENSE_TERMS=		primary:{{WRKDIR}}/TERMS
LICENSE_SOURCE=		TERMS:{{WRKSRC}}/COPYING
LICENSE_AWK=		TERMS:"---"
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		archivers/rpm4

BUILD_DEPENDS=		libarchive:dev:standard
			bzip2:dev:standard
			dbus:dev:standard
			libgcrypt:dev:standard
			libgpg-error:dev:standard
			ncurses:dev:standard
			readline:dev:standard
# #			rpm-sequoia:dev:standard
			xz:dev:standard
			zstd:dev:standard
BUILDRUN_DEPENDS=	bzip2:primary:standard
			dbus:primary:standard
			file:single:standard
			libarchive:primary:standard
			libgcrypt:primary:standard
			popt:single:standard
			readline:primary:standard
# #			rpm-sequoia:primary:standard
			xz:primary:standard
			zstd:primary:standard

USES=			cmake fortran:library gettext lua:5.4 pkgconfig python
			shebangfix sqlite ssl zlib
SHEBANG_FILES=		scripts/brp-compress
			scripts/check-rpaths-worker
			scripts/check-prereqs
			scripts/find-lang.sh
			scripts/fontconfig.prov
			scripts/ocamldeps.sh
			scripts/perl.prov
			scripts/perl.req
			scripts/pkgconfigdeps.sh
			scripts/rpm_macros_provides.sh
			scripts/sysusers.sh

# For now just disable Linux-only stuff & things that cause problems
CMAKE_ARGS=		-DWITH_CAP=OFF
			-DWITH_ACL=OFF
			-DWITH_AUDIT=OFF
			-DWITH_SELINUX=OFF
			-DWITH_INTERNAL_OPENPGP=ON
			-DENABLE_NDB=OFF
			-DENABLE_TESTSUITE=OFF
SOVERSION=		${SOVERSION}
PLIST_SUB=		PORTVERSION=${PORTVERSION}

EXRUN[primary]=		library
EXRUN[python]=		library

post-install:
	${RM} -r ${STAGEDIR}/var
.for b in ${BINARIES}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/bin/${b}
.endfor
.for l in ${LIBRARIES}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/${l}.so
.endfor
.for p in ${PLUGINS}
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/rpm-plugins/${p}.so
.endfor
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/python3.12/site-packages/rpm/_rpm.so
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/rpm/rpmdeps
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/rpm/rpmuncompress

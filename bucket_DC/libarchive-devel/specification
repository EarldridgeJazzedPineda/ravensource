DEF[PORTVERSION]=	3.3.3
DEF[SOVERSION]=		13.3.3
DEF[SOMAJOR]=		${SOVERSION:R:R}
DEF[TAG]=		4763691
# ----------------------------------------------------------------------------

NAMEBASE=		libarchive-devel
VERSION=		${PORTVERSION}
KEYWORDS=		archivers
VARIANTS=		standard
SDESC[standard]=	Library to handle various archive formats (devel)
HOMEPAGE=		http://libarchive.org/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GITHUB/libarchive:libarchive:${TAG}
DISTFILE[1]=		generated:main

SPKGS[standard]=	complete shared static

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		BSD2CLAUSE:static BSD3CLAUSE:static PUBDOM:static
LICENSE_FILE=		BSD2CLAUSE:{{WRKSRC}}/COPYING
			BSD3CLAUSE:{{WRKSRC}}/COPYING
			PUBDOM:{{WRKSRC}}/COPYING
LICENSE_SCHEME=		multi

FPC_EQUIVALENT=		archivers/libarchive

BUILD_DEPENDS=		bzip2:static:standard
			expat:static:standard
			autoconf:single:standard
			automake:single:standard
BUILDRUN_DEPENDS=	libressl:single:standard
			xz:single:standard
			bzip2:shared:standard
			expat:shared:standard
			Zstandard:single:standard

USES=			cpe libtool:build perl:build pkgconfig zlib
MUST_CONFIGURE=		gnu
INSTALL_TARGET=		install-strip
CONFIGURE_ARGS=		--without-xml2
			--without-iconv
			--enable-shared=yes
			--enable-bsdtar=static
			--enable-bsdcat=static
			--enable-bsdcpio=static
LDFLAGS=		-lpthread
PLIST_SUB=		SOVERSION=${SOVERSION}
			SOMAJOR=${SOMAJOR}


pre-configure:
	(cd ${WRKSRC} && build/autogen.sh)

post-configure:
	${REINPLACE_CMD} -e '/libname_spec=/ s/name"/name-devel"/' \
		${WRKSRC}/libtool

post-install:
	${RM} -r ${STAGEDIR}${MANPREFIX}/man
.for prog in tar cat cpio
	${MV} ${STAGEDIR}${PREFIX}/bin/bsd${prog} \
		${STAGEDIR}${PREFIX}/bin/bsd${prog}-devel
.endfor
	${REINPLACE_CMD} -i'' -e 's/larchive/larchive-devel/' \
		${STAGEDIR}${PREFIX}/lib/pkgconfig/libarchive.pc

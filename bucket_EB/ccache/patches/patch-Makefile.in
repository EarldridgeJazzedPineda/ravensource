--- Makefile.in.orig	2018-02-11 18:16:12 UTC
+++ Makefile.in
@@ -90,7 +90,8 @@ clean:
 
 conf.c: confitems_lookup.c envtoconfitems_lookup.c
 
-$(zlib_objs): CPPFLAGS += -include config.h
+$(zlib_objs):
+	$(CC) $(all_cppflags) -include config.h $(all_cflags) -c src/zlib/${.TARGET:T:.o=.c} -o ${.TARGET} $<
 
 zlib/libz.a: $(zlib_objs)
 	$(AR) cr $@ $(zlib_objs)

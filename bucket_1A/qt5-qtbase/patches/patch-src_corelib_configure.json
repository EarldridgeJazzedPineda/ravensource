--- src/corelib/configure.json.orig	2019-04-09 09:51:26 UTC
+++ src/corelib/configure.json
@@ -61,8 +61,7 @@
             },
             "headers": "iconv.h",
             "sources": [
-                { "libs": "-liconv", "condition": "config.openbsd || config.haiku" },
-                { "libs": "", "condition": "!(config.openbsd || config.haiku)" }
+                { "libs": "-liconv" }
             ]
         },
         "gnu_iconv": {
@@ -133,43 +132,28 @@
         "libatomic": {
             "label": "64 bit atomics",
             "test": {
-                "tail": [
-                    "void test(volatile std::atomic<std::int64_t> &a)",
-                    "{",
-                    "    std::int64_t v = a.load(std::memory_order_acquire);",
-                    "    while (!a.compare_exchange_strong(v, v + 1,",
-                    "                                      std::memory_order_acq_rel,",
-                    "                                      std::memory_order_acquire)) {",
-                    "        v = a.exchange(v - 1);",
-                    "    }",
-                    "    a.store(v + 1, std::memory_order_release);",
-                    "}"
-                ],
                 "main": [
                     "void *ptr = (void*)0xffffffc0; // any random pointer",
-                    "test(*reinterpret_cast<std::atomic<std::int64_t> *>(ptr));"
+                    "return 0;"
                 ],
                 "qmake": "CONFIG += c++11"
             },
-            "headers": [ "atomic", "cstdint" ],
             "sources": [
-                "",
-                "-latomic"
+                ""
             ]
         },
         "libdl": {
             "label": "dlopen()",
             "test": {
+                "include": "dlfcn.h",
                 "main": [
-                    "dlclose(dlopen(0, 0));",
-                    "dlsym(RTLD_DEFAULT, 0);",
+                    "dlclose(dlopen(0, RTLD_LAZY));",
                     "dlerror();"
                 ]
             },
-            "headers": "dlfcn.h",
             "sources": [
                 "",
-                "-ldl"
+                { "libs": "-ldl" }
             ]
         },
         "librt": {

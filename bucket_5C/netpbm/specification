DEF[PORTVERSION]=	10.88.01
DEF[SOVERSION]=		11.88
DEF[MAIN_TAG]=		9e4a4ee
DEF[USERGUIDE_TAG]=	780e282
# ----------------------------------------------------------------------------

NAMEBASE=		netpbm
VERSION=		${PORTVERSION}
KEYWORDS=		graphics
VARIANTS=		standard
SDESC[standard]=	Toolkit for manipulation of graphic images
HOMEPAGE=		http://netpbm.sourceforge.net/
CONTACT=		nobody

DOWNLOAD_GROUPS=	main guide
SITES[main]=		GITHUB/leahneukirchen:netpbm-mirror:${MAIN_TAG}
SITES[guide]=		GITHUB/leahneukirchen:netpbm-mirror:${USERGUIDE_TAG}
DISTFILE[1]=		generated:main
DISTFILE[2]=		generated:guide
DF_INDEX=		1 2

SPKGS[standard]=	single

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

LICENSE=		CUSTOM1:single
LICENSE_NAME=		CUSTOM1:"Netpbm multi-license (at least 8)"
LICENSE_FILE=		CUSTOM1:{{WRKSRC}}/doc/copyright_summary
LICENSE_SCHEME=		solo

FPC_EQUIVALENT=		graphics/netpbm

BUILD_DEPENDS=		autoselect-python:single:standard
BUILDRUN_DEPENDS=	tiff:primary:standard
			jasper:primary:standard
			jbigkit:single:standard
			xz:single:standard

USES=			gmake jpeg png perl shebangfix python:build
XORG_COMPONENTS=	x11 xcb xau xdmcp
GNOME_COMPONENTS=	libxml2
SHEBANG_FILES=		buildtools/makeman
			editor/pnmflip
			editor/pnmquant
			editor/ppmfade
			editor/ppmquant
			editor/ppmshadow
			generator/ppmrainbow
			converter/pbm/pbmtox10bm
			test/Execute-Tests
			test/*.test
			test/Available-Testprog
MAKEFILE=		GNUmakefile
INSTALL_TARGET=		install.bin
			install.lib
			install.data
			install.hdr
			install.staticlib
MAKE_ARGS=		pkgdir={{STAGEDIR}}{{PREFIX}}
			BINMODE={{BINMODE}}
			SHAREMODE={{SHAREMODE}}
			DATAMODE={{_SHAREMODE}}
			DIRMODE=755
			MANMODE={{MANMODE}}
			DATADIR={{DATADIR}}
SOVERSION=		${SOVERSION}
VAR_OPSYS[dragonfly]=	MAKE_ARGS=LD="cc -fuse-ld=gold"

post-patch:
	${REINPLACE_CMD} -e 's|misc|share/netpbm|g' ${WRKSRC}/common.mk
	${REINPLACE_CMD} \
		-e 's|/sharedlink|/lib|g' \
		-e 's|/staticlink|/lib|g' \
		${WRKSRC}/lib/Makefile
	${REINPLACE_CMD} \
		-e 's|pkg-config|false|g' \
		${WRKSRC}/GNUmakefile

do-configure:
	${CAT} ${WRKSRC}/config.mk.in ${FILESDIR}/config.mk > ${WRKSRC}/config.mk

post-build:
	${MAKE_CMD} \
		MAKEMAN="${WRKSRC}/buildtools/makeman" \
		USERGUIDE="${WRKDIR}/netpbm-mirror-${USERGUIDE_TAG}" \
		-C ${WRKSRC} -f "${WRKSRC}/buildtools/manpage.mk" manpages

post-install:
.if "${.MAKE.OS.NAME}" == "Darwin"
	(cd ${STAGEDIR}${PREFIX}/lib && ${LN} -sf libnetpbm.11.dylib libnetpbm.dylib)
.else
	(cd ${STAGEDIR}${PREFIX}/lib && ${LN} -sf libnetpbm.so.11 libnetpbm.so)
.endif
	${STRIP_CMD} ${STAGEDIR}${PREFIX}/lib/libnetpbm.${LIBEXT}
	${RM} ${STAGEDIR}${PREFIX}/bin/manweb
	${INSTALL_DATA} ${WRKSRC}/lib/util/pm_c_util.h ${WRKSRC}/pm_config.h \
		${STAGEDIR}${PREFIX}/include/netpbm
	${INSTALL_MAN} ${WRKSRC}/*.1 ${STAGEDIR}${MANPREFIX}/man/man1
	${INSTALL_MAN} ${WRKSRC}/*.3 ${STAGEDIR}${MANPREFIX}/man/man3
	${INSTALL_MAN} ${WRKSRC}/*.5 ${STAGEDIR}${MANPREFIX}/man/man5

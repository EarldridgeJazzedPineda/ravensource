DEF[PORTVERSION]=	1.1
DEF[DL_FOLDER]=		1.1
DEF[GCCX]=		EXTRACT_INFO(CURRENT_GCC)
DEF[COMP_RPATH]=	{{PREFIX}}/toolchain/${GCCX}/{{ASLIB}}:{{PREFIX}}/lib
# ----------------------------------------------------------------------------

NAMEBASE=		gcab
VERSION=		${PORTVERSION}
KEYWORDS=		archivers
VARIANTS=		standard
SDESC[standard]=	Cabinet file library and tool
HOMEPAGE=		https://wiki.gnome.org/msitools
CONTACT=		nobody

DOWNLOAD_GROUPS=	main
SITES[main]=		GNOME/gcab/${DL_FOLDER}
DISTFILE[1]=		gcab-${PORTVERSION}.tar.xz:main

SPKGS[standard]=	complete primary docs

OPTIONS_AVAILABLE=	none
OPTIONS_STANDARD=	none

FPC_EQUIVALENT=		archivers/gcab

BUILD_DEPENDS=		vala:single:standard
# |			gtk-doc:single:standard

USES=			cpe gettext-tools gmake libtool pkgconfig meson
GNOME_COMPONENTS=	glib intltool introspection
CPE_VENDOR=		gnome
MESON_ARGS=		-Ddocs=false

post-patch:
	${REINPLACE_CMD} -e "s|install : true|install : true, install_rpath : '${COMP_RPATH}'|" \
		${WRKSRC}/libgcab/meson.build ${WRKSRC}/src/meson.build

# gtk-docs are not registered correctly.  Disable docs until it's figured out
# I/O error : Attempt to load network entity http://docbook.sourceforge.net/
#             release/xsl/current/html/chunk.xsl
# warning: failed to load external entity "http://docbook.sourceforge.net/
#             release/xsl/current/html/chunk.xsl"
# compilation error: file /raven/share/gtk-doc/data/gtk-doc.xsl line 10
#             element import
# xsl:import : unable to load http://docbook.sourceforge.net/release/xsl/
#             current/html/chunk.xsl

post-install:
	@${MKDIR} ${STAGEDIR}${STD_DOCDIR}
	${ECHO_CMD} "gtk-doc fails to find chunk.xsl even though it's installed (no docs)" \
		> ${STAGEDIR}${STD_DOCDIR}/README.txt
